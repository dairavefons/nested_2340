{% extends 'base.html' %}

{% block title %}Edit Item - GT Nest{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <h2>Edit Item</h2>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
                <label for="{{ form.title.id_for_label }}" class="form-label">Title</label>
                {{ form.title }}
                {% if form.title.errors %}
                    <div class="text-danger">{{ form.title.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                {{ form.description }}
                {% if form.description.errors %}
                    <div class="text-danger">{{ form.description.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.product_type.id_for_label }}" class="form-label">Product Type</label>
                {{ form.product_type }}
                {% if form.product_type.errors %}
                    <div class="text-danger">{{ form.product_type.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.condition.id_for_label }}" class="form-label">Condition</label>
                {{ form.condition }}
                {% if form.condition.errors %}
                    <div class="text-danger">{{ form.condition.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.price.id_for_label }}" class="form-label">Price</label>
                {{ form.price }}
                {% if form.price.errors %}
                    <div class="text-danger">{{ form.price.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3 form-check">
                {{ form.is_free }}
                <label for="{{ form.is_free.id_for_label }}" class="form-check-label">ITEM IS FREE!</label>
                {% if form.is_free.errors %}
                    <div class="text-danger">{{ form.is_free.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.payment_method.id_for_label }}" class="form-label">Payment Method</label>
                {{ form.payment_method }}
                {% if form.payment_method.errors %}
                    <div class="text-danger">{{ form.payment_method.errors }}</div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.photo.id_for_label }}" class="form-label">Photo</label>
                {% if post.photo %}
                    <div class="mb-2">
                        <img src="{{ post.photo.url }}" alt="{{ post.title }}" style="max-width: 200px; max-height: 200px;">
                        <p class="form-text">Current photo (upload a new one to replace)</p>
                    </div>
                {% endif %}
                {{ form.photo }}
                {% if form.photo.errors %}
                    <div class="text-danger">{{ form.photo.errors }}</div>
                {% endif %}
                <div class="form-text">Upload a photo of your item (optional)</div>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a href="{% url 'post_detail' post.id %}" class="btn btn-secondary me-md-2">Cancel</a>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const priceInput = document.getElementById('id_price');
    const isFreeCheckbox = document.getElementById('id_is_free');

    // Function to handle the free item checkbox
    function handleFreeItemChange() {
        if (isFreeCheckbox.checked) {
            priceInput.value = '';
            priceInput.disabled = true;
        } else {
            priceInput.disabled = false;
        }
    }

    // Add event listener to checkbox
    isFreeCheckbox.addEventListener('change', handleFreeItemChange);

    // Initialize state on page load
    handleFreeItemChange();
});
</script>
{% endblock %}
